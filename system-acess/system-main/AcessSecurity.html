<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlowOp - Verificação de Segurança</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        #space-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }
        .loader-dot {
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
    </style>
</head>
<body class="bg-gray-900 text-white overflow-hidden">
    <div id="space-background"></div>
    
    <div id="permission-modal" class="fixed inset-0 bg-black bg-opacity-80 z-50 flex items-center justify-center hidden">
        <div class="bg-white p-8 rounded-xl text-center max-w-md">
            <i data-feather="shield" class="w-16 h-16 text-blue-600 mx-auto mb-4"></i>
            <h2 class="text-2xl font-bold text-gray-800 mb-4">Verificação de Segurança</h2>
            <p class="text-gray-600 mb-6">Precisamos realizar uma verificação de segurança. Você autoriza a análise de suas informações de navegação?</p>
            
            <div class="flex space-x-4 justify-center">
                <button id="allow-btn" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">
                    Permitir
                </button>
                <button id="deny-btn" class="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700">
                    Negar
                </button>
            </div>
            
            <div class="mt-4">
                <label class="text-gray-700 flex items-center justify-center">
                    <input type="checkbox" id="never-show-again" class="mr-2">
                    Não mostrar novamente
                </label>
            </div>
        </div>
    </div>

    <div id="verification-screen" class="hidden fixed inset-0 flex flex-col items-center justify-center">
        <div class="text-center">
            <h1 class="text-4xl font-bold mb-8">Verificando Segurança</h1>
            <div class="flex justify-center space-x-4 mb-8">
                <div id="ip-check" class="loader-dot p-2 bg-blue-500 rounded-full"></div>
                <div id="browser-check" class="loader-dot p-2 bg-green-500 rounded-full"></div>
                <div id="network-check" class="loader-dot p-2 bg-purple-500 rounded-full"></div>
                <div id="security-check" class="loader-dot p-2 bg-yellow-500 rounded-full"></div>
            </div>
            
            <div class="w-96 bg-gray-700 rounded-full h-4 mb-4">
                <div id="progress-bar" class="bg-blue-600 h-4 rounded-full" style="width: 0%"></div>
            </div>
            
            <p id="status-text" class="text-xl">Iniciando verificação...</p>
        </div>
    </div>

    <div id="report-modal" class="fixed inset-0 bg-black bg-opacity-80 z-50 flex items-center justify-center hidden">
        <div class="bg-white p-8 rounded-xl text-center max-w-md">
            <i data-feather="check-circle" class="w-16 h-16 text-green-600 mx-auto mb-4"></i>
            <h2 class="text-2xl font-bold text-gray-800 mb-4">Verificação Concluída</h2>
            <p class="text-gray-600 mb-6">Seu sistema foi verificado e nenhuma ameaça foi detectada.</p>
            
            <div class="flex space-x-4 justify-center">
                <button id="download-report" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">
                    Baixar Relatório
                </button>
                <button id="continue-btn" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700">
                    Continuar
                </button>
            </div>
            
            <div class="mt-4">
                <label class="text-gray-700 flex items-center justify-center">
                    <input type="checkbox" id="no-show-report" class="mr-2">
                    Não mostrar novamente
                </label>
            </div>
        </div>
    </div>

    <script>
        const checks = {
            ip: document.getElementById('ip-check'),
            browser: document.getElementById('browser-check'),
            network: document.getElementById('network-check'),
            security: document.getElementById('security-check')
        };

        const progressBar = document.getElementById('progress-bar');
        const statusText = document.getElementById('status-text');

        async function fetchIPAddress() {
            const response = await fetch('https://api.ipify.org?format=json');
            const data = await response.json();
            return data.ip;
        }

        function analyzeBrowser() {
            return {
                userAgent: navigator.userAgent,
                platform: navigator.platform,
                cookiesEnabled: navigator.cookieEnabled
            };
        }

        async function testNetworkConnectivity() {
            const url = 'https://www.google.com/favicon.ico'; // Exemplo de teste de ping
            const startTime = Date.now();
            try {
                await fetch(url, { method: 'HEAD', mode: 'no-cors' });
                return Date.now() - startTime;
            } catch {
                return null;
            }
        }

        function checkHTTPS() {
            return location.protocol === 'https:';
        }

        async function startSecurityCheck() {
            statusText.textContent = 'Verificando IP e localização...';
            const ip = await fetchIPAddress();
            checks.ip.classList.add('bg-green-500');
            progressBar.style.width = '25%';
            console.log(`IP: ${ip}`);

            statusText.textContent = 'Analisando configurações do navegador...';
            const browserData = analyzeBrowser();
            checks.browser.classList.add('bg-green-500');
            progressBar.style.width = '50%';
            console.log('Dados do navegador:', browserData);

            statusText.textContent = 'Verificando configurações de rede...';
            const latency = await testNetworkConnectivity();
            checks.network.classList.add('bg-green-500');
            progressBar.style.width = '75%';
            console.log(`Latência de rede: ${latency}ms`);

            statusText.textContent = 'Verificação final de segurança...';
            const isSecure = checkHTTPS();
            checks.security.classList.add('bg-green-500');
            progressBar.style.width = '100%';
            console.log(`Conexão segura: ${isSecure}`);
        }

        window.onload = () => startSecurityCheck();
    </script>
</body>
</html>
