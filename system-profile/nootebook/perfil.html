<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfil Profissional - FlowOps</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --background-color: #f8f9fa;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--background-color);
        }

        #sidebar {
            height: 100vh;
            width: 250px;
            position: fixed;
            top: 0;
            left: 0;
            background-color: #343a40;
            padding-top: 20px;
            color: white;
        }

        #sidebar .nav-link {
            color: white;
            transition: all 0.3s;
        }

        #sidebar .nav-link:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        #content {
            margin-left: 250px;
            padding: 20px;
        }

        #banner {
            height: 200px;
            background-size: cover;
            background-position: center;
            position: relative;
        }

        #profile-picture {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            border: 5px solid white;
            position: absolute;
            bottom: -75px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1;
        }

        #user-info {
            text-align: center;
            padding-top: 80px;
        }

        .section {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .social-links a {
            font-size: 24px;
            margin: 0 10px;
            color: var(--primary-color);
            transition: all 0.3s;
        }

        .social-links a:hover {
            color: var(--secondary-color);
        }

        #edit-profile-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }

        .project-card {
            border: none;
            border-radius: 10px;
            transition: all 0.3s;
        }

        .project-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .specialty-badge {
            font-size: 18px;
            margin: 5px;
            padding: 10px 15px;
            border-radius: 25px;
        }

        #user-note {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: rgba(255, 255, 255, 0.8);
            padding: 10px;
            border-radius: 5px;
            max-width: 200px;
        }
    </style>
</head>
<body>
    <div id="sidebar">
        <ul class="nav flex-column">
            <li class="nav-item">
                <a class="nav-link active" href="#"><i class="fas fa-user"></i> Perfil</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="index.html"><i class="fas fa-chart-line"></i> Dashboard</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#"><i class="fas fa-cog"></i> Configurações</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#"><i class="fas fa-sign-out-alt"></i> Sair</a>
            </li>
        </ul>
    </div>

    <div id="content">
        <div id="banner">
            <div id="user-note">
                <!-- Nota do usuário será inserida aqui via JavaScript -->
            </div>
        </div>
        <img src="" alt="Foto de Perfil" id="profile-picture">
        
        <div id="user-info">
            <h2 id="username">Nome de Usuário</h2>
            <h4 id="full-name">Nome Completo</h4>
        </div>

        <div class="section" id="bio">
            <h3>Biografia</h3>
            <p id="bio-text"></p>
        </div>

        <div class="section">
            <h3>Redes Sociais</h3>
            <div class="social-links" id="social-links">
                <!-- Links de redes sociais serão inseridos aqui via JavaScript -->
            </div>
        </div>

        <div class="section" id="work-experience">
            <h3>Experiência Profissional</h3>
            <!-- Experiências profissionais serão inseridas aqui via JavaScript -->
        </div>

        <div class="section" id="projects">
            <h3>Projetos</h3>
            <div class="row" id="projects-container">
                <!-- Projetos serão inseridos aqui via JavaScript -->
            </div>
        </div>

        <div class="section" id="specialties">
            <h3>Especialidades</h3>
            <div id="specialties-container">
                <!-- Especialidades serão inseridas aqui via JavaScript -->
            </div>
        </div>
    </div>

    <button id="edit-profile-btn" class="btn btn-primary btn-lg rounded-circle">
        <i class="fas fa-plus"></i>
    </button>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
    <script>
        // Configuração do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDaffUTJnaBW7ppaHo_UQOBMHrlvMXTdGw",
            authDomain: "flowops-7e9f0.firebaseapp.com",
            databaseURL: "https://flowops-7e9f0-default-rtdb.firebaseio.com",
            projectId: "flowops-7e9f0",
            storageBucket: "flowops-7e9f0.firebasestorage.app",
            messagingSenderId: "541008189245",
            appId: "1:541008189245:web:58eeb67a2507ab0bb1d754",
            measurementId: "G-KHZ92X24C4"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);

        // Referência para o banco de dados
        const database = firebase.database();

        // Verificar autenticação
        firebase.auth().onAuthStateChanged((user) => {
            if (user) {
                loadUserProfile(user.uid);
            } else {
                window.location.href = 'login.html';
            }
        });

        function loadUserProfile(uid) {
            database.ref('users/' + uid).once('value').then((snapshot) => {
                const userData = snapshot.val();
                if (userData) {
                    updateProfileUI(userData);
                }
            });
        }

        function updateProfileUI(userData) {
            // Atualizar banner
            document.getElementById('banner').style.backgroundImage = `url(${userData.bannerImage || 'default-banner.jpg'})`;

            // Atualizar foto de perfil
            document.getElementById('profile-picture').src = userData.profilePicture || 'default-profile.jpg';

            // Atualizar nome de usuário e nome completo
            document.getElementById('username').textContent = userData.username || 'Nome de Usuário';
            document.getElementById('full-name').textContent = userData.fullName || 'Nome Completo';

            // Atualizar biografia
            document.getElementById('bio-text').innerHTML = userData.bio || 'Nenhuma biografia disponível.';

            // Atualizar redes sociais
            updateSocialLinks(userData.socialLinks);

            // Atualizar experiência profissional
            updateWorkExperience(userData.workExperience);

            // Atualizar projetos
            updateProjects(userData.projects);

            // Atualizar especialidades
            updateSpecialties(userData.specialties);

            // Atualizar nota do usuário
            updateUserNote(userData.userNote);

            // Atualizar background
            updateBackground(userData.background);
        }

        function updateSocialLinks(socialLinks) {
            const container = document.getElementById('social-links');
            container.innerHTML = '';
            if (socialLinks) {
                for (const [platform, url] of Object.entries(socialLinks)) {
                    if (url) {
                        const icon = getSocialIcon(platform);
                        container.innerHTML += `<a href="${url}" target="_blank"><i class="${icon}"></i></a>`;
                    }
                }
            }
        }

        function getSocialIcon(platform) {
            const icons = {
                facebook: 'fab fa-facebook',
                twitter: 'fab fa-twitter',
                linkedin: 'fab fa-linkedin',
                instagram: 'fab fa-instagram',
                github: 'fab fa-github',
                youtube: 'fab fa-youtube',
                twitch: 'fab fa-twitch'
            };
            return icons[platform] || 'fas fa-link';
        }

        function updateWorkExperience(workExperience) {
            const container = document.getElementById('work-experience');
            container.innerHTML = '<h3>Experiência Profissional</h3>';
            if (workExperience && workExperience.length > 0) {
                workExperience.forEach(job => {
                    container.innerHTML += `
                        <div class="card mb-3">
                            <div class="card-body">
                                <h5 class="card-title">${job.company}</h5>
                                <h6 class="card-subtitle mb-2 text-muted">${job.position}</h6>
                                <p class="card-text">
                                    ${job.startDate} - ${job.endDate || 'Presente'}
                                </p>
                            </div>
                        </div>
                    `;
                });
            } else {
                container.innerHTML += '<p>Nenhuma experiência profissional cadastrada.</p>';
            }
        }

        function updateProjects(projects) {
            const container = document.getElementById('projects-container');
            container.innerHTML = '';
            if (projects && projects.length > 0) {
                projects.forEach(project => {
                    container.innerHTML += `
                        <div class="col-md-4 mb-4">
                            <div class="card project-card">
                                <img src="${project.image}" class="card-img-top" alt="${project.title}">
                                <div class="card-body">
                                    <h5 class="card-title">${project.title}</h5>
                                    <h6 class="card-subtitle mb-2 text-muted">${project.subtitle}</h6>
                                    <p class="card-text">${project.description}</p>
                                    ${project.link ? `<a href="${project.link}" class="btn btn-primary" target="_blank">Ver Projeto</a>` : ''}
                                </div>
                            </div>
                        </div>
                    `;
                });
            } else {
                container.innerHTML = '<p>Nenhum projeto cadastrado.</p>';
            }
        }

        function updateSpecialties(specialties) {
            const container = document.getElementById('specialties-container');
            container.innerHTML = '';
            if (specialties && specialties.length > 0) {
                specialties.forEach(specialty => {
                    container.innerHTML += `
                        <span class="badge bg-primary specialty-badge" style="color: ${specialty.color};">
                            <i class="${specialty.icon}"></i> ${specialty.name}
                        </span>
                    `;
                });
            } else {
                container.innerHTML = '<p>Nenhuma especialidade cadastrada.</p>';
            }
        }

        function updateUserNote(note) {
            const noteElement = document.getElementById('user-note');
            if (note && isNoteValid(note)) {
                noteElement.textContent = note.text;
                noteElement.style.display = 'block';
            } else {
                noteElement.style.display = 'none';
            }
        }

        function isNoteValid(note) {
            const now = new Date();
            const noteDate = new Date(note.timestamp);
            const diffHours = (now - noteDate) / (1000 * 60 * 60);
            return diffHours <= 24;
        }

        function updateBackground(background) {
            const body = document.body;
            if (background) {
                if (background.type === 'color') {
                    body.style.backgroundColor = background.value;
                } else if (background.type === 'gradient') {
                    body.style.background = background.value;
                } else if (background.type === 'image' || background.type === 'gif') {
                    body.style.backgroundImage = `url(${background.value})`;
                    body.style.backgroundSize = 'cover';
                    body.style.backgroundAttachment = 'fixed';
                }
            }
        }

        document.getElementById('edit-profile-btn').addEventListener('click', () => {
            window.location.href = 'editor.html';
        });

        // Inicializar AOS
        AOS.init();
    </script>
</body>
</html>
