
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfil Profissional</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vanta@0.5.24/dist/vanta.net.min.js"></script>
    <style>
        .profile-picture {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            border: 4px solid white;
            position: absolute;
            bottom: -75px;
            left: 50%;
            transform: translateX(-50%);
        }
        .banner {
            height: 200px;
            background-size: cover;
            background-position: center;
        }
        .note {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: rgba(255, 255, 255, 0.8);
            padding: 10px;
            border-radius: 5px;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="flex">
        <!-- Sidebar -->
        <div class="w-64 h-screen bg-gray-800 text-white p-4">
            <h2 class="text-2xl font-bold mb-4">Menu</h2>
            <ul>
                <li class="mb-2"><a href="#" class="hover:text-gray-300">Dashboard</a></li>
                <li class="mb-2"><a href="#" class="hover:text-gray-300">Perfil</a></li>
                <li class="mb-2"><a href="#" class="hover:text-gray-300">Configurações</a></li>
            </ul>
        </div>

        <!-- Main Content -->
        <div class="flex-1">
            <!-- Banner and Profile Picture -->
            <div class="relative">
                <div id="banner" class="banner"></div>
                <img id="profilePicture" src="https://via.placeholder.com/150" alt="Profile Picture" class="profile-picture">
                <div id="note" class="note hidden">
                    <p id="noteText"></p>
                </div>
            </div>

            <!-- User Info -->
            <div class="mt-20 text-center">
                <h1 id="userName" class="text-3xl font-bold"></h1>
                <p id="fullName" class="text-xl text-gray-600"></p>
            </div>

            <!-- Biography -->
            <div id="bio" class="mt-6 mx-auto max-w-2xl p-4 rounded-lg"></div>

            <!-- Social Connections -->
            <div id="socialConnections" class="mt-6 flex justify-center space-x-4"></div>

            <!-- Work Experience -->
            <div id="workExperience" class="mt-6 mx-auto max-w-2xl">
                <h2 class="text-2xl font-bold mb-4">Experiência Profissional</h2>
            </div>

            <!-- Projects -->
            <div id="projects" class="mt-6 mx-auto max-w-2xl">
                <h2 class="text-2xl font-bold mb-4">Projetos</h2>
            </div>

            <!-- Specialties -->
            <div id="specialties" class="mt-6 mx-auto max-w-2xl">
                <h2 class="text-2xl font-bold mb-4">Especialidades</h2>
                <div class="flex flex-wrap justify-center"></div>
            </div>

            <!-- Edit Profile Button -->
            <div class="fixed bottom-4 right-4">
                <a href="system-edit/edit.html" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-full">
                    <i class="fas fa-plus"></i> Editar Perfil
                </a>
            </div>
        </div>
    </div>

    <script type="module">
        // Import Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDaffUTJnaBW7ppaHo_UQOBMHrlvMXTdGw",
            authDomain: "flowops-7e9f0.firebaseapp.com",
            databaseURL: "https://flowops-7e9f0-default-rtdb.firebaseio.com",
            projectId: "flowops-7e9f0",
            storageBucket: "flowops-7e9f0.firebasestorage.app",
            messagingSenderId: "541008189245",
            appId: "1:541008189245:web:58eeb67a2507ab0bb1d754",
            measurementId: "G-KHZ92X24C4"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);

        // Check if user is authenticated
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // User is signed in, fetch profile data
                const userRef = ref(db, 'users/' + user.uid);
                onValue(userRef, (snapshot) => {
                    const data = snapshot.val();
                    updateProfile(data);
                });
            } else {
                // User is signed out, redirect to login page
                window.location.href = 'login.html';
            }
        });

        function updateProfile(data) {
            // Update banner
            document.getElementById('banner').style.backgroundImage = `url(${data.banner || 'https://via.placeholder.com/1000x200'})`;

            // Update profile picture
            document.getElementById('profilePicture').src = data.profilePicture || 'https://via.placeholder.com/150';

            // Update user name and full name
            document.getElementById('userName').textContent = data.userName || 'Username';
            document.getElementById('fullName').textContent = data.fullName || 'Full Name';

            // Update note
            if (data.note && new Date(data.note.expiry) > new Date()) {
                document.getElementById('noteText').textContent = data.note.text;
                document.getElementById('note').classList.remove('hidden');
            }

            // Update biography
            const bioElement = document.getElementById('bio');
            bioElement.innerHTML = data.biography || 'No biography available.';
            if (data.biographyStyle) {
                Object.assign(bioElement.style, data.biographyStyle);
            }

            // Update social connections
            const socialElement = document.getElementById('socialConnections');
            socialElement.innerHTML = '';
            if (data.socialConnections) {
                for (const [platform, url] of Object.entries(data.socialConnections)) {
                    if (url) {
                        const icon = document.createElement('a');
                        icon.href = url;
                        icon.target = '_blank';
                        icon.innerHTML = `<i class="fab fa-${platform} fa-2x"></i>`;
                        socialElement.appendChild(icon);
                    }
                }
            }

            // Update work experience
            const workElement = document.getElementById('workExperience');
            workElement.innerHTML = '<h2 class="text-2xl font-bold mb-4">Experiência Profissional</h2>';
            if (data.workExperience) {
                data.workExperience.forEach(job => {
                    const jobElement = document.createElement('div');
                    jobElement.className = 'mb-4';
                    jobElement.innerHTML = `
                        <h3 class="text-xl font-semibold">${job.company}</h3>
                        <p>${job.position}</p>
                        <p>${job.startDate} - ${job.endDate || 'Present'}</p>
                    `;
                    workElement.appendChild(jobElement);
                });
            } else {
                workElement.innerHTML += '<p>Nenhuma experiência profissional adicionada.</p>';
            }

            // Update projects
            const projectsElement = document.getElementById('projects');
            projectsElement.innerHTML = '<h2 class="text-2xl font-bold mb-4">Projetos</h2>';
            if (data.projects) {
                data.projects.forEach(project => {
                    const projectElement = document.createElement('div');
                    projectElement.className = 'mb-4';
                    projectElement.innerHTML = `
                        <h3 class="text-xl font-semibold">${project.title}</h3>
                        <h4 class="text-lg">${project.subtitle}</h4>
                        <p>${project.description}</p>
                        ${project.image ? `<img src="${project.image}" alt="${project.title}" class="mt-2 max-w-full h-auto">` : ''}
                        ${project.link ? `<a href="${project.link}" target="_blank" class="mt-2 inline-block bg-blue-500 text-white px-4 py-2 rounded">Ver Projeto</a>` : ''}
                    `;
                    projectsElement.appendChild(projectElement);
                });
            } else {
                projectsElement.innerHTML += '<p>Nenhum projeto adicionado.</p>';
            }

            // Update specialties
            const specialtiesElement = document.getElementById('specialties').querySelector('div');
            specialtiesElement.innerHTML = '';
            if (data.specialties) {
                data.specialties.forEach(specialty => {
                    const specialtyElement = document.createElement('div');
                    specialtyElement.className = 'flex items-center m-2';
                    specialtyElement.innerHTML = `
                        <i class="${specialty.icon} text-3xl mr-2" style="color: ${specialty.color};"></i>
                        <span>${specialty.name}</span>
                    `;
                    specialtiesElement.appendChild(specialtyElement);
                });
            } else {
                specialtiesElement.innerHTML = '<p>Nenhuma especialidade adicionada.</p>';
            }

            // Update background
            if (data.background) {
                if (data.background.type === 'color') {
                    document.body.style.backgroundColor = data.background.value;
                } else if (data.background.type === 'gradient') {
                    document.body.style.background = data.background.value;
                } else if (data.background.type === '3d') {
                    VANTA.NET({
                        el: "body",
                        mouseControls: true,
                        touchControls: true,
                        gyroControls: false,
                        minHeight: 200.00,
                        minWidth: 200.00,
                        scale: 1.00,
                        scaleMobile: 1.00,
                        color: 0x3fa9f5,
                        backgroundColor: 0xffffff,
                        points: 20.00,
                        maxDistance: 30.00,
                        spacing: 15.00
                    })
                } else if (data.background.type === 'image' || data.background.type === 'gif') {
                    document.body.style.backgroundImage = `url(${data.background.value})`;
                    document.body.style.backgroundSize = 'cover';
                    document.body.style.backgroundAttachment = 'fixed';
                }
            }
        }
    </script>
</body>
</html>

